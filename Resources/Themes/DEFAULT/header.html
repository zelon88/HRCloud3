<?php

/* 
HonestRepair Diablo Engine  -  Header
https://www.HonestRepair.net
https://github.com/zelon88

Licensed Under GNU GPLv3
https://www.gnu.org/licenses/gpl-3.0.html

Author: Justin Grimes
Date: 2/21/2022
<3 Open-Source

The Header file is for preparing an HTML document to contain the output of Diablo Engine.
*/

// / The following code sets safe default variables incase the config file cannot be loaded.
// / These variables will be overwritten by the ones contained in config.php once it has been loaded. 
$ApplicationName = 'HRCloud3 Diablo Engine';
$StayLoggedInInterval = 45000;

// / Attempt to load the config.php file.
if (!isset($ConfigIsLoaded) and file_exists('../../../config.php')) include('../../../config.php');
?> 

<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='UTF-8'>
    <!-- Populate the title field with the ApplicationName from the config.php file. -->
    <title><?php echo $ApplicationName; ?></title>
    <!-- Load JQuery. This should be pointed to a local source. Keep it up-to-date. Do not place other scripts above this one. -->
    <script type='text/javascript' src='/Resources/jquery-3.5.1.min.js'></script>
    <script type='text/javascript'>
      // / Declare PHP controlled global Javascript variables.
      let StayLoggedInInterval = '<?php echo $StayLoggedInInterval; ?>';
      let ApplicationName = '<?php echo $ApplicationName; ?>';
    </script>
    <link rel='shortcut icon' href='/Resources/Themes/DEFAULT/favicon.ico'/>
    <!-- Load stylesheets -->
    <link rel='stylesheet' href='/Resources/Styles/navigationStyles.css'/>
    <link rel='stylesheet' href='/Resources/Styles/modalStyles.css'/>
    <link rel='stylesheet' href='/Resources/Styles/centerAnything.css'/>
    <link rel='stylesheet' href='/Resources/Styles/meyers-reset.css'>
    <link rel='stylesheet' href='/Resources/Styles/style.css'>
    <link rel='stylesheet' href='/Resources/Styles/buttons.css'>
  </head>
  <body style="background-image: url('debut_dark.webp');">
  <!-- An invisible iframe to use as a target to prevent form POSTS from reloading the page. -->
  <iframe style='width:0; height:0; border:0; border:none; position:absolute; visibility:hidden; display:none;' id='noredirect' name='noredirect'></iframe>

  <!-- Top navigation bar. -->
  <ul class='top-level'>
    <li>
      <a href='Home.php'>Home</a>
    </li>

    <li>
      <a href='javascript:;'>About</a>   
      <ul class='second-level'>
        <li>
          <a href='javascript:;'>Contact</a>
        </li>
       <li>
          <a href='javascript:;'>Privacy Policy</a>
        </li>
       <li>
          <a href='javascript:;'>Terms Of Service</a>
        </li>
      </ul>
    </li>

    <li>
      <a href='CloudHome.php'>Cloud</a>   
      <ul class='second-level'>
        <li>
          <a href='javascript:;'>Apps</a>
        </li>
       <li>
          <a href='javascript:;'>Drive</a>
        </li>
       <li>
          <a href='javascript:;'>Settings</a>
        </li>
      </ul>
    </li>

<?php /* 
    <li>
      <a href='javascript:;'>Test</a>
      <ul class='second-level'>
        <li>
          <a href='javascript:;'>Test</a>
        </li>
        <li>
          <a href='javascript:;'>Test</a>
        </li>
        <li>
          <a href='javascript:;'>Test</a>
        </li>
      </ul>
    </li>
 */ ?>

    <li>
      <!-- Login / Logout Buttons -->
      <a id='loginButton' style='display:block;' onclick='toggleVisibility("loginModal");'>Login</a>
      <a id='logoutButton' style='display:none;' onclick='toggleVisibility("logoutModal");'>Logout</a>
    </li>

    <li>
      <a>â˜°</a>
    </li>
  </ul>

  <!-- The Username Modal -->
  <div id='modals'>
    <!-- The Username Modal -->
    <div id='loginModal' class='modal' name='loginModal'>
      <!-- Username Modal Content. -->
      <form id='loginFormNav' class='modalContent animate' name='loginFormNav' method='POST' target='noredirect'>
        <!-- Username Modal Header -->
        <div id='loginModalHeader' class='modalHeader' name='loginModalHeader'>
          <img  id='avatarSmallLogin' class='avatar-small' name='avatarSmallLogin' src='/Resources/Themes/DEFAULT/placeholderAvatar.png' alt='Avatar'>
          <a id='modalHeaderText' class='modalHeaderText' name='modalHeaderText'>Enter Your <?php echo $ApplicationName; ?> Username</a>
          <img id='closeButtonLogin' class='closeButton' name='closeButtonLogin' src='/Resources/Themes/DEFAULT/x24.png' alt='Close' title='Close Window' onclick='toggleVisibility("loginModal");'>
          <img id='helpLogin' class='helpButton' name='helpLogin' src='/Resources/Themes/DEFAULT/help24.png' alt='Help' title='If you already have an <?php echo $ApplicationName; ?> account and remember your username; type it into the text field then press the "Continue" button to proceed. If you do not remember your username; press the "Forgot Username" button and follow the instructions to recover your account. If you would like to create a new account; press the "Create Account" button. To close this window without taking any action; press the red "X" icon in the top-right corner of the window.'>
        </div>

        <!-- Username Modal Message Container -->
        <div id='loginContainer' class='container' name='loginContainer' style='background-color:#f1f1f1; text-align:center;'>
          <input type='text' id='UserInput' class='textInput' name='UserInput' title='Enter your <?php echo $ApplicationName; ?> username into this field.' placeholder='Enter Username' value='' required>
          <input type='hidden' id='requestTokens' name='RequestTokens' value='' required>
          <button id='submitButton' class='BUTTON_1' name='submitButton'  title='Proceed with login.' style='margin:10px;'>Continue</button>
          <br />
          <hr />
          <button type='button' id='forgotUsernameButton' class='BUTTON_1' name='forgotUsernameButton' onclick='' title='Recover an account with a forgotten username.' style='margin:10px;'>Forgot Username</button>
          <button type='button' id='createAccountButton' class='BUTTON_1' name='createAccountButton' onclick='toggleVisibility("loginModal"); toggleVisibility("createAccountModal");' title='Create a new <?php echo $ApplicationName; ?> account.' style='margin:10px;'>Create New Account</button>
          <br />
        </div>
      </form>
    </div>

    <!-- The Password Modal -->
    <div id='passwordModal' class='modal' name='passwordModal'>
      <!-- Password Modal Content. -->
      <form id='passwordFormNav' class='modalContent animate' name='passwordFormNav' method='POST' target='noredirect'>
        <!-- Password Modal Header -->
        <div id='passwordModalHeader' class='modalHeader' name='passwordModalHeader'>
          <img id='avatarSmallPassword' class='avatar-small' name='avatarSmallPassword' src='/Resources/Themes/DEFAULT/placeholderAvatar.png' alt='Avatar'>
          <a id='modalHeaderText' name='modalHeaderText' class='modalHeaderText'>Enter Your <?php echo $ApplicationName; ?> Password</a>
          <img id='closeButtonPassword' class='closeButton' name='closeButtonPassword' src='/Resources/Themes/DEFAULT/x24.png' alt='Close' title='Close Window' onclick='toggleVisibility("passwordModal");'>
          <img id='helpPassword' class='helpButton' name='helpPassword' src='/Resources/Themes/DEFAULT/help24.png' alt='Help' title='If you remember your <?php echo $ApplicationName; ?> password; type it into the text field then press the "Continue" button to proceed. If you do not remember your password; press the "Forgot Password" button and follow the instructions to recover your account. To close this window without taking any action; press the red "X" icon in the top-right corner of the window.'>
        </div>

        <!-- Password Modal Message Container -->
        <div id='passwordContainer' name='passwordContainer' style='background-color:#f1f1f1; text-align:center;' class='container'>
          <input type='password' placeholder='Enter Password' id='RawPassword' name='RawPassword' title='Enter your <?php echo $ApplicationName; ?> password.' style='padding: 10px;' required>
          <input type='hidden' id='ClientTokenInput' name='ClientTokenInput' value='' required>
          <input type='hidden' id='PasswordInput' name='PasswordInput' value='' required>
          <input type='hidden' id='UserInputPassword' name='UserInput' value='' required>
          <button id='submitButton' onclick='secureLogin(document.getElementById("RawPassword").value);' class='BUTTON_1' title='Proceed with login.' style='margin:10px;'>Continue</button>
          <br />
          <hr />
          <button type='button' class='BUTTON_1' title='Recover an account with a forgotten password.' style='margin:10px;'>Forgot Password</button>
          <br />
        </div>
      </form>
    </div>

    <!-- The Successful Login Modal -->
    <div id='successModal' name='successModal' class='modal'>
      <!-- Successful Login Modal Content. -->
      <div id='successModalContent' name='successModalContent' class='modalContent animate'>
        <!-- Successful Login Modal Header -->
        <div id='successModalHeader' name='successModalHeader' class='modalHeader'>
          <img src='/Resources/Themes/DEFAULT/placeholderAvatar.png' id='avatarSmallSuccess' name='avatarSmallSuccess' alt='Avatar' class='avatar-small'>
          <a id='modalHeaderText' name='modalHeaderText' class='modalHeaderText'>Login Success</a>
          <img src='/Resources/Themes/DEFAULT/x24.png' id='closeButtonSuccess' name='closeButtonSuccess' onclick='toggleVisibility("successModal");' alt='Close' title='Close Window' class='closeButton'>
          <img src='/Resources/Themes/DEFAULT/help24.png' id='helpSuccess' name='helpSuccess' alt='Help' title='Your login credentials are valid. This window will disappear shortly. To close this window; press the red "X" icon in the top-right corner of the window.' class='helpButton'>
        </div>
        <!-- Successful Login Modal Message Container -->
        <div id='successContainer' name='successContainer' style='background-color:#f1f1f1; text-align:center; display:block;' class='container'>
          <br />
          <p>Success! Please wait.</p>
          <br />
        </div> 
      </div>
    </div>

    <!-- The Failed Login Modal -->
    <div id='errorModal' name='errorModal' class='modal'>
      <!-- Failed Login Modal Content. -->
      <div id='errorModalContent' name='errorModalContent' class='modalContent animate'>
        <!-- Failed Login Modal Header -->
        <div id='errorModalHeader' name='errorModalHeader' class='modalHeader'>
          <img src='/Resources/Themes/DEFAULT/alert24.png' id='warningSmallError' name='warningSmallError' alt='Alert' class='warning-small'>
          <a id='modalHeaderText' name='modalHeaderText' class='modalHeaderText'>Login Failed</a>
          <img src='/Resources/Themes/DEFAULT/x24.png' id='closeButtonError' name='closeButtonError' onclick='toggleVisibility("errorModal");' alt='Close' title='Close Window' class='closeButton'>
          <img src='/Resources/Themes/DEFAULT/help24.png' id='helpError' name='helpError' alt='Help' title='Your login credentials are not valid. This window will disappear shortly. To close this window; press the red "X" icon in the top-right corner of the window.' class='helpButton'>
        </div>
        <!-- Failed Login Modal Message Container -->
        <div id='errorContainer' name='errorContainer' style='background-color:#f1f1f1; text-align:center; display:block;' class='container'>
          <br />
          <p>Login failed! Please try again.</p>
          <br />
        </div> 
      </div>
    </div>

    <!-- The Critical Login Error Modal -->
    <div id='criticalModal' name='criticalModal' class='modal'>
      <!-- Critical Login Error Modal Content. -->
      <div id='criticalModalContent' name='criticalModalContent' class='modalContent animate'>
        <!-- Critical Login Error Modal Header -->
        <div id='criticalModalHeader' name='criticalModalHeader' class='modalHeader'>
          <img src='/Resources/Themes/DEFAULT/exclamation24.png' id='errorSmallCritical' name='errorSmallCritical' alt='Error' class='error-small'>
          <a id='modalHeaderText' name='modalHeaderText' class='modalHeaderText'>Login Error</a>
          <img src='/Resources/Themes/DEFAULT/x24.png' id='closeButtonCritical' name='closeButtonCritical' onclick='toggleVisibility("criticalModal");' alt='Close' title='Close Window' class='closeButton'>
          <img src='/Resources/Themes/DEFAULT/help24.png' id='helpCritical' name='helpCritical' alt='Help' title='An error occurred and your login request could not be completed. Please try again later. This window will disappear shortly. To close this window; press the red "X" icon in the top-right corner of the window.' class='helpButton'>
        </div>
        <!-- Critical Login Error Modal Message Container -->
        <div id='criticalContainer' name='criticalContainer' style='background-color:#f1f1f1; text-align:center; display:block;' class='container'>
          <br />
          <p>There was a critical error during login. Please contact support and try again later.</p>
          <br />
        </div> 
      </div>
    </div>

    <!-- The Logout Modal -->
    <div id='logoutModal' name='logoutModal' class='modal'>
      <!-- Logout Modal Content. -->
      <div id='logoutModalContent' name='logoutModalContent' class='modalContent animate'>
        <!-- Logout Modal Header -->
        <div id='logoutModalHeader' name='logoutModalHeader' class='modalHeader'>
          <img src='/Resources/Themes/DEFAULT/placeholderAvatar.png' id='avatarSmallLogout' name='avatarSmallLogout' alt='Avatar' class='avatar-small'>
          <a id='modalHeaderText' name='modalHeaderText' class='modalHeaderText'>Logout of <?php echo $ApplicationName; ?></a>
          <img src='/Resources/Themes/DEFAULT/x24.png' id='closeButtonLogout' name='closeButtonLogout' onclick='toggleVisibility("logoutModal");' alt='Close' title='Close Window' class='closeButton'>
          <img src='/Resources/Themes/DEFAULT/help24.png' id='helpLogout' name='helpLogout' alt='Help' title='To log out of your <?php echo $ApplicationName; ?> account; press the "Confirm Logout" button. If you log out of your account you will have to login again before you can continue to use <?php echo $ApplicationName; ?>. To stay logged in; press the "Cancel" button. To close this window without taking any action; press the red "X" icon in the top-right corner of the window.' class='helpButton'>
        </div>
        <!-- Logout Modal Message Container -->
        <div id='logoutContainer' name='logoutContainer' style='background-color:#f1f1f1; text-align:center;' class='container'>
          <br />
          <p>Are you sure you want to log out?</p>
          <input type='hidden' id='UserInput' name='UserInput' value='' required>
          <input type='hidden' id='requestTokens' name='RequestTokens' value='' required>
          <br />
          <button id='logoutConfirmButton' onclick='toggleVisibility("logoutModal"); toggleVisibility("logoutButton"); toggleVisibility("loginButton"); toggleVisibility("successModal"); setTimeout(function() { toggleVisibility("successModal"); }, 3000);' class='BUTTON_1'>Confirm Logout</button>
          <hr />
          <button type='button' onclick='toggleVisibility("logoutModal");' class='BUTTON_1' title='Cancel' style='margin:10px;'>Cancel</button>
        </div>
    </div>
  </div>
</div>

    <!-- The Create Account Modal -->
    <div id='createAccountModal' name='createAccountModal' class='modal'>
      <!-- Critical Login Error Modal Content. -->
      <div id='createAccountModalContent' name='createAccountModalContent' class='modalContent animate'>
        <!-- Critical Login Error Modal Header -->
        <div id='createAccountModalHeader' name='createAccountModalHeader' class='modalHeader'>
          <img src='/Resources/Themes/DEFAULT/placeholderAvatar.png' id='avatarSmallLogin' name='avatarSmallLogin' alt='Avatar' class='avatar-small'>
          <a id='modalHeaderText' name='modalHeaderText' class='modalHeaderText'>Create A New Account</a>
          <img src='/Resources/Themes/DEFAULT/x24.png' id='closeButtonCreate' name='closeButtonCreate' onclick='toggleVisibility("createAccountModal");' alt='Close' title='Close Window' class='closeButton'>
          <img src='/Resources/Themes/DEFAULT/help24.png' id='helpCreate' name='helpCreate' alt='Help' title='To close this window; press the red "X" icon in the top-right corner of the window.' class='helpButton'>
        </div>
        <!-- Create Account Modal Message Container -->
        <div id='createAccountContainer' name='createAccountContainer' style='background-color:#f1f1f1; text-align:center; display:block;' class='container'>
          <input type='text' placeholder='Enter Desired Username' id='NewUserInput' name='NewUserInput' title='Enter your desired <?php echo $ApplicationName; ?> username.' style='padding: 10px;' required>
          <br /> 
          <button id='checkButton' onclick='checkAvailability(document.getElementById("NewUserInput").value);' class='BUTTON_1' title='Check username availability.' style='margin:10px;'>Check Availability</button>
          <input type='hidden' id='ClientTokenInput' name='ClientTokenInput' value='' required>
          <br />
          <p id='checkResultsNever' name='checkResultsNever' style='display:block;'>Please enter an available username to continue.</p>
          <p id='checkResultsSuccess' name='checkResultsSuccess' style='display:none;'><b>Congratulations!</b> The desired username is <b>available</b>!</p>
          <p id='checkResultsFailure' name='checkResultsFailure' style='display:none;'><b>Sorry!</b> The desired username is <b>not available</b>.</p>
          <br />
          <div id='createAccountDetails' name='createAccountDetails' style="display:none;">
            <input type='text' placeholder='Enter Your Email Address' id='NewUserEmail' name='NewUserEmail' title='Enter your email address.' style='padding: 10px;' required>
            <input type='password' placeholder='Enter Your Desired Password' id='NewUserPassword' name='NewUserPassword' title='Enter your desired password.' style='padding: 10px;' required>
            <input type='password' placeholder='Enter Your Desired Password Again' id='NewUserPasswordConfirm' name='NewUserPasswordConfirm' title='Enter your desired password.' style='padding: 10px;' required>
            <button id='submitButton' onclick='createAccount();' class='BUTTON_1' title='Proceed with account creation.' style='margin:10px;'>Create Account</button>
            <br />
          </div>
          <hr />
          <button type='button' class='BUTTON_1' title='Recover an account with a forgotten password.' style='margin:10px;'>Forgot Password</button>
          <br />
        </div> 
      </div>
    </div>

<!-- Hidden Login Form For Storing Keep-Alive Variables -->
<form id='tokens' name='tokens' method='post' target='noredirect'>
  <input type='hidden' id='UserInputTokens' name='UserInput' value='' required>
  <input type='hidden' id='SessionID' name='SessionID' value='' required>
  <input type='hidden' id='ClientToken' name='ClientToken' value='' required>
  <input type='hidden' id='ActiveSLI' name='ActiveSLI' value='DISABLED' required>
  <input type='hidden' id='StayLoggedIn' name='StayLoggedIn' value='DISABLED' required>
</form>

<!-- These scripts are loaded at the end of the page to allow the rest of the page to load before introducing additional functionality. -->
<!-- Expect problems if you move these. -->
<script type='text/javascript' src='/Resources/sjcl.js'></script>
<script type='text/javascript' src='/Resources/HRC3-Lib.js'></script>
<script type='text/javascript' src='/Resources/Login-Caller.js'></script>