<?php

/* 
HonestRepair Diablo Engine  -  Header
https://www.HonestRepair.net
https://github.com/zelon88

Licensed Under GNU GPLv3
https://www.gnu.org/licenses/gpl-3.0.html

Author: Justin Grimes
Date: 2/16/2022
<3 Open-Source

The Header file is for preparing an HTML document to contain the output of Diablo Engine.
*/

// / The following code sets safe default variables incase the config file cannot be loaded.
// / These variables will be overwritten by the ones contained in config.php once it has been loaded. 
$ApplicationName = 'HRCloud3 Diablo Engine';
$StayLoggedInInterval = 45000;

// / Attempt to load the config.php file.
if (!isset($ConfigIsLoaded) and file_exists('../../../config.php')) include('../../../config.php');
?> 

<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='UTF-8'>
    <!-- Populate the title field with the ApplicationName from the config.php file. -->
    <title><?php echo $ApplicationName; ?></title>
    <!-- Load JQuery. This should be pointed to a local source. Keep it up-to-date. Do not place other scripts above this one. -->
    <script type='text/javascript' src='/Resources/jquery-3.5.1.min.js'></script>
    <script type='text/javascript'>
      // / Declare PHP controlled global Javascript variables.
      let StayLoggedInInterval = '<?php echo $StayLoggedInInterval; ?>';
      let ApplicationName = '<?php echo $ApplicationName; ?>';
    </script>
    <link rel='shortcut icon' href='/Resources/Themes/DEFAULT/favicon.ico'/>
    <!-- Load stylesheets -->
    <link rel='stylesheet' href='/Resources/Styles/navigationStyles.css'/>
    <link rel='stylesheet' href='/Resources/Styles/modalStyles.css'/>
    <link rel='stylesheet' href='/Resources/Styles/centerAnything.css'/>
    <link rel='stylesheet' href='/Resources/Styles/meyers-reset.css'>
    <link rel='stylesheet' href='/Resources/Styles/style.css'>
    <link rel='stylesheet' href='/Resources/Styles/buttons.css'>
  </head>
  <body style="background-image: url('debut_dark.webp');">
  <!-- An invisible iframe to use as a target to prevent form POSTS from reloading the page. -->
  <iframe style='width:0; height:0; border:0; border:none; position:absolute; visibility:hidden; display:none;' id='noredirect' name='noredirect'></iframe>
  <!-- Top navigation bar. -->
  <ul class='top-level'>
    <li>
      <a href='Home.php'>Home</a>
    </li>

    <li>
      <a href='javascript:;'>About</a>   
      <ul class='second-level'>
        <li>
          <a href='javascript:;'>Contact</a>
        </li>
       <li>
          <a href='javascript:;'>Privacy Policy</a>
        </li>
       <li>
          <a href='javascript:;'>Terms Of Service</a>
        </li>
      </ul>
    </li>

    <li>
      <a href='CloudHome.php'>Cloud</a>   
      <ul class='second-level'>
        <li>
          <a href='javascript:;'>Apps</a>
        </li>
       <li>
          <a href='javascript:;'>Drive</a>
        </li>
       <li>
          <a href='javascript:;'>Settings</a>
        </li>
      </ul>
    </li>

<?php /* 
    <li>
      <a href='javascript:;'>Test</a>
      <ul class='second-level'>
        <li>
          <a href='javascript:;'>Test</a>
        </li>
        <li>
          <a href='javascript:;'>Test</a>
        </li>
        <li>
          <a href='javascript:;'>Test</a>
        </li>
      </ul>
    </li>
 */ ?>

    <li>
      <!-- Button to open the modal login form. -->
      <a id='loginButton' style='display:block;' onclick='toggleVisibility("loginModal");'>Login</a>
      <a id='logoutButton' style='display:none;' onclick='toggleVisibility("logoutModal");'>Logout</a>
    </li>

    <li>
      <a>â˜°</a>
    </li>
  </ul>

  <div id='modals'>
    <!-- The Login Modal -->
    <div id='loginModal' class='modal'>
      <!-- Login Modal Content. -->
      <form id='loginFormNav' name='loginFormNav' method='POST' target='noredirect' class='modal-content animate'>
        

            <div class='modal-header'>
              <img src='/Resources/Themes/DEFAULT/placeholderAvatar.png' id='avatarSmall' name='avatarSmall' alt='Avatar' class='avatar-small'>
              <img src='/Resources/Themes/DEFAULT/x24.png' id='closeButton' name='closeButton' onclick='toggleVisibility("loginModal");' alt='Close' class='close-button'>
              <a style='display: inline-block; margin-top: 4px;'>Log in to <?php echo $ApplicationName; ?></a>
            </div>
            

        <div id='loginContainer' name='loginContainer' style='background-color:#f1f1f1; text-align:center;' class='container'>
          <input type='text' placeholder='Enter Username' id='UserInput' value='' name='UserInput' style='padding: 10px;' required>
          <input type='hidden' id='requestTokens' name='RequestTokens' value='' required>
          <button id='submitButton' class='BUTTON_1' style='margin:10px;'>Continue</button>
          <br>
          <hr>
          <button type='button' class='BUTTON_1' style='margin:10px;'>Forgot Username</button>
          <button type='button' class='BUTTON_1' style='margin:10px;'>Create New Account</button>
          <br>
        </div>
      </form>
    </div>

    <!-- The Password Modal -->
    <div id='passwordModal' class='modal'>
      <!-- Password Modal Content. -->
      <form id='passwordFormNav' name='passwordFormNav' method='POST' target='noredirect' class='modal-content animate'>
        <div id='modalCornerAvatarContainer' class='imgcontainer'>
          <img src='/Resources/Themes/DEFAULT/placeholderAvatar.png' alt='Avatar' class='avatar'>
        </div>
        <div id='passwordContainer' name='passwordContainer' style='background-color:#f1f1f1; text-align:center; display:block;' class='container'>
          <br />
          <input type='password' placeholder='Enter Password' id='RawPassword' name='RawPassword' required>
          <input type='hidden' id='ClientTokenInput' name='ClientTokenInput' value='' required>
          <input type='hidden' id='PasswordInput' name='PasswordInput' value='' required>
          <input type='hidden' id='UserInputPassword' name='UserInput' value='' required>
          <br />
          <p><button id='submitButton' onclick='secureLogin(document.getElementById("RawPassword").value);' class='BUTTON_1'>Continue</button></p>
          <br />
          <span class='psw'><a href='#'>Forgot Password</a></span>
          <br />
          <span class='psw'><a href='#'>Create New Account</a></span>
          <br />
          <p><button type='button' onclick='toggleVisibility("passwordModal");' class='BUTTON_1'>Cancel</button></p>
        </div>
      </form>
    </div>

    <div id='successModal' class='modal'>
      <!-- Password Modal Content. -->
      <div class='modal-content animate'>  
        <div id='modalCornerAvatarContainer' class='imgcontainer'>
          <img src='/Resources/Themes/DEFAULT/placeholderAvatar.png' alt='Avatar' class='avatar'>
        </div>
        <div id='successContainer' name='successContainer' style='background-color:#f1f1f1; text-align:center; display:block;' class='container'>
          <br />
          <p>Success! Please wait.</p>
          <br />
        </div> 
      </div>
    </div>

    <div id='errorModal' class='modal'>
      <!-- Password Modal Content. -->
      <div class='modal-content animate'>  
        <div id='modalCornerAvatarContainer' class='imgcontainer'>
          <img src='/Resources/Themes/DEFAULT/placeholderAvatar.png' alt='Avatar' class='avatar'>
        </div>
        <div id='errorContainer' name='errorModal' style='background-color:#f1f1f1; text-align:center; display:block;' class='container'>
          <br />
          <p>Login failed! Please try again.</p>
          <br />
        </div> 
      </div>
    </div>

    <div id='criticalModal' class='modal'>
      <!-- Password Modal Content. -->
      <div class='modal-content animate'>  
        <div id='modalCornerAvatarContainer' class='imgcontainer'>
          <img src='/Resources/Themes/DEFAULT/placeholderAvatar.png' alt='Avatar' class='avatar'>
        </div>
        <div id='criticalContainer' name='criticalModal' style='background-color:#f1f1f1; text-align:center; display:block;' class='container'>
          <br />
          <p>There was a critical error during login. Please contact support and try again later.</p>
          <br />
        </div> 
      </div>
    </div>

    <!-- The Logout Modal -->
    <div id='logoutModal' class='modal'>
      <!-- Login Modal Content. -->
      <form id='logoutFormNav' name='logoutFormNav' method='POST' target='noredirect' class='modal-content animate'>
        <div id='modalCornerAvatarContainer' class='imgcontainer'>
          <img src='/Resources/Themes/DEFAULT/placeholderAvatar.png' alt='Avatar' class='avatar'>
        </div>
        <div id='logoutContainer' name='logoutContainer' style='background-color:#f1f1f1; text-align:center;' class='container'>
          <br />
          <p>Are you sure you want to log out?</p>
          <input type='hidden' id='UserInput' name='UserInput' value='' required>
          <input type='hidden' id='requestTokens' name='RequestTokens' value='' required>
          <br />
          <p><button id='logoutConfirmButton' onclick='toggleVisibility("logoutModal"); toggleVisibility("logoutButton"); toggleVisibility("loginButton"); toggleVisibility("successModal"); setTimeout(function() { toggleVisibility("successModal"); }, 3000);' class='BUTTON_1'>Confirm Logout</button></p>
          <br />
          <p><button type='button' onclick='toggleVisibility("logoutModal");' class='BUTTON_1'>Cancel</button></p>
        </div>
      </form>
    </div>
  </div>

  <form id='tokens' name='tokens' method='post' target='noredirect'>
    <input type='hidden' id='UserInputTokens' name='UserInput' value='' required>
    <input type='hidden' id='SessionID' name='SessionID' value='' required>
    <input type='hidden' id='ClientToken' name='ClientToken' value='' required>
    <input type='hidden' id='ActiveSLI' name='ActiveSLI' value='DISABLED' required>
    <input type='hidden' id='StayLoggedIn' name='StayLoggedIn' value='DISABLED' required>
  </form>

<!--This div and the commented code in Login-Caller.js make up a test to ensure JQuery is functioning properly. 
<div id='test' name='test'>
<a>Test JQuery</a>
</div> -->

<!-- These scripts are loaded at the end of the page to allow the rest of the page to load before introducing additional functionality. -->
<!-- Expect problems if you move these. -->
<script type='text/javascript' src='/Resources/sjcl.js'></script>
<script type='text/javascript' src='/Resources/HRC3-Lib.js'></script>
<script type='text/javascript' src='/Resources/Login-Caller.js'></script>