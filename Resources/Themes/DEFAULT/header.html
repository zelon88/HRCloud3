<?php

/* 
HonestRepair Diablo Engine  -  Header
https://www.HonestRepair.net
https://github.com/zelon88

Licensed Under GNU GPLv3
https://www.gnu.org/licenses/gpl-3.0.html

Author: Justin Grimes
Date: 2/21/2022
<3 Open-Source

The Header file is for preparing an HTML document to contain the output of Diablo Engine.
*/

// / The following code sets safe default variables incase the config file cannot be loaded.
// / These variables will be overwritten by the ones contained in config.php once it has been loaded. 
$ApplicationName = 'HRCloud3 Diablo Engine';
$StayLoggedInInterval = 45000;

// / Attempt to load the config.php file.
if (!isset($ConfigIsLoaded) and file_exists('../../../config.php')) include('../../../config.php');
?> 

<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='UTF-8'>
    <!-- Populate the title field with the ApplicationName from the config.php file. -->
    <title><?php echo $ApplicationName; ?></title>
    <!-- Load JQuery. This should be pointed to a local source. Keep it up-to-date. Do not place other scripts above this one. -->
    <script type='text/javascript' src='/Resources/jquery-3.5.1.min.js'></script>
    <script type='text/javascript'>
      // / Declare PHP controlled global Javascript variables.
      let StayLoggedInInterval = '<?php echo $StayLoggedInInterval; ?>';
      let ApplicationName = '<?php echo $ApplicationName; ?>';
    </script>
    <link rel='shortcut icon' href='/Resources/Themes/DEFAULT/favicon.ico'/>
    <!-- Load stylesheets -->
    <link rel='stylesheet' href='/Resources/Styles/navigationStyles.css'/>
    <link rel='stylesheet' href='/Resources/Styles/modalStyles.css'/>
    <link rel='stylesheet' href='/Resources/Styles/centerAnything.css'/>
    <link rel='stylesheet' href='/Resources/Styles/meyers-reset.css'>
    <link rel='stylesheet' href='/Resources/Styles/style.css'>
    <link rel='stylesheet' href='/Resources/Styles/buttons.css'>
  </head>
  <body style="background-image: url('debut_dark.webp');">
  <!-- An invisible iframe to use as a target to prevent form POSTS from reloading the page. -->
  <iframe style='width:0; height:0; border:0; border:none; position:absolute; visibility:hidden; display:none;' id='noredirect' name='noredirect'></iframe>

  <!-- Top navigation bar. -->
  <ul class='top-level'>
    <li>
      <a href='Home.php'>Home</a>
    </li>

    <li>
      <a href='javascript:;'>About</a>   
      <ul class='second-level'>
        <li>
          <a href='javascript:;'>Contact</a>
        </li>
       <li>
          <a href='javascript:;'>Privacy Policy</a>
        </li>
       <li>
          <a href='javascript:;'>Terms Of Service</a>
        </li>
      </ul>
    </li>

    <li>
      <a href='CloudHome.php'>Cloud</a>   
      <ul class='second-level'>
        <li>
          <a href='javascript:;'>Apps</a>
        </li>
       <li>
          <a href='javascript:;'>Drive</a>
        </li>
       <li>
          <a href='javascript:;'>Settings</a>
        </li>
      </ul>
    </li>

<?php /* 
    <li>
      <a href='javascript:;'>Test</a>
      <ul class='second-level'>
        <li>
          <a href='javascript:;'>Test</a>
        </li>
        <li>
          <a href='javascript:;'>Test</a>
        </li>
        <li>
          <a href='javascript:;'>Test</a>
        </li>
      </ul>
    </li>
 */ ?>

    <li>
      <!-- Login / Logout Buttons -->
      <a id='loginButton' style='display:block;' onclick='toggleVisibility("loginModal");'>Login</a>
      <a id='logoutButton' style='display:none;' onclick='toggleVisibility("logoutModal");'>Logout</a>
    </li>

    <li>
      <a>â˜°</a>
    </li>
  </ul>

  <!-- The Username Modal -->
  <div id='modals'>
    <!-- The Username Modal -->
    <div id='loginModal' class='modal'>
      <!-- Username Modal Content. -->
      <form id='loginFormNav' name='loginFormNav' method='POST' target='noredirect' class='modal-content animate'>
        <!-- Username Modal Header -->
        <div id='loginModalHeader' name='loginModalHeader' class='modal-header'>
          <img src='/Resources/Themes/DEFAULT/placeholderAvatar.png' id='avatarSmallLogin' name='avatarSmallLogin' alt='Avatar' class='avatar-small'>
          <a style='display: inline-block; margin-top: 4px;'>Enter Your <?php echo $ApplicationName; ?> Username</a>
          <img src='/Resources/Themes/DEFAULT/x24.png' id='closeButtonLogin' name='closeButtonLogin' onclick='toggleVisibility("loginModal");' alt='Close' title='Close Window' class='close-button'>
          <img src='/Resources/Themes/DEFAULT/help24.png' id='helpLogin' name='helpLogin' alt='Help' title='If you already have an <?php echo $ApplicationName; ?> account and remember your username; type it into the text field then press the "Continue" button to proceed. If you do not remember your username; press the "Forgot Username" button and follow the instructions to recover your account. If you would like to create a new account; press the "Create Account" button. To close this window without taking any action; press the red "X" icon in the top-right corner of the window.' class='help-button'>
        </div>
        <!-- Username Modal Message Container -->
        <div id='loginContainer' name='loginContainer' style='background-color:#f1f1f1; text-align:center;' class='container'>
          <input type='text' placeholder='Enter Username' id='UserInput' value='' name='UserInput' title='Enter your <?php echo $ApplicationName; ?> username into this field.' style='padding: 10px;' required>
          <input type='hidden' id='requestTokens' name='RequestTokens' value='' required>
          <button id='submitButton' class='BUTTON_1' title='Proceed with login.' style='margin:10px;'>Continue</button>
          <br />
          <hr />
          <button type='button' class='BUTTON_1' title='Recover an account with a forgotten username.' style='margin:10px;'>Forgot Username</button>
          <button type='button' class='BUTTON_1' title='Create a new <?php echo $ApplicationName; ?> account.' style='margin:10px;'>Create New Account</button>
          <br />
        </div>
      </form>
    </div>

    <!-- The Password Modal -->
    <div id='passwordModal' class='modal'>
      <!-- Password Modal Content. -->
      <form id='passwordFormNav' name='passwordFormNav' method='POST' target='noredirect' class='modal-content animate'>
        <!-- Password Modal Header -->
        <div id='passwordModalHeader' name='passwordModalHeader' class='modal-header'>
          <img src='/Resources/Themes/DEFAULT/placeholderAvatar.png' id='avatarSmallPassword' name='avatarSmallPassword' alt='Avatar' class='avatar-small'>
          <a style='display: inline-block; margin-top: 4px;'>Enter Your <?php echo $ApplicationName; ?> Password</a>
          <img src='/Resources/Themes/DEFAULT/x24.png' id='closeButtonPassword' name='closeButtonPassword' onclick='toggleVisibility("passwordModal");' alt='Close' title='Close Window' class='close-button'>
          <img src='/Resources/Themes/DEFAULT/help24.png' id='helpPassword' name='helpPassword' alt='Help' title='If you remember your  <?php echo $ApplicationName; ?> password; type it into the text field then press the "Continue" button to proceed. If you do not remember your password; press the "Forgot Password" button and follow the instructions to recover your account. To close this window without taking any action; press the red "X" icon in the top-right corner of the window.' class='help-button'>
        </div>
        <!-- Password Modal Message Container -->
        <div id='passwordContainer' name='passwordContainer' style='background-color:#f1f1f1; text-align:center;' class='container'>
          <input type='password' placeholder='Enter Password' id='RawPassword' name='RawPassword' title='Enter your <?php echo $ApplicationName; ?> password.' style='padding: 10px;' required>
          <input type='hidden' id='ClientTokenInput' name='ClientTokenInput' value='' required>
          <input type='hidden' id='PasswordInput' name='PasswordInput' value='' required>
          <input type='hidden' id='UserInputPassword' name='UserInput' value='' required>
          <button id='submitButton' onclick='secureLogin(document.getElementById("RawPassword").value);' class='BUTTON_1' title='Proceed with login.' style='margin:10px;'>Continue</button>
          <br />
          <hr />
          <button type='button' class='BUTTON_1' title='Recover an account with a forgotten password.' style='margin:10px;'>Forgot Password</button>
          <br />
        </div>
      </form>
    </div>

    <!-- The Successful Login Modal -->
    <div id='successModal' class='modal'>
      <!-- Successful Login Modal Content. -->
      <div id='successModalContent' name='successModalContent' class='modal-content animate'>
        <!-- Successful Login Modal Header -->
        <div id='successModalHeader' name='successModalHeader' class='modal-header'>
          <img src='/Resources/Themes/DEFAULT/placeholderAvatar.png' id='avatarSmallSuccess' name='avatarSmallSuccess' alt='Avatar' class='avatar-small'>
          <a style='display: inline-block; margin-top: 4px;'>Login Success</a>
          <img src='/Resources/Themes/DEFAULT/x24.png' id='closeButtonSuccess' name='closeButtonSuccess' onclick='toggleVisibility("successModal");' alt='Close' title='Close Window' class='close-button'>
          <img src='/Resources/Themes/DEFAULT/help24.png' id='helpSuccess' name='helpSuccess' alt='Help' title='Your login credentials are valid. This window will disappear shortly. To close this window; press the red "X" icon in the top-right corner of the window.' class='help-button'>
        </div>
        <!-- Successful Login Modal Message Container -->
        <div id='successContainer' name='successContainer' style='background-color:#f1f1f1; text-align:center; display:block;' class='container'>
          <br />
          <p>Success! Please wait.</p>
          <br />
        </div> 
      </div>
    </div>

    <!-- The Failed Login Modal -->
    <div id='errorModal' class='modal'>
      <!-- Failed Login Modal Content. -->
      <div id='errorModalContent' name='errorModalContent' class='modal-content animate'>
        <!-- Failed Login Modal Header -->
        <div id='errorModalHeader' name='errorModalHeader' class='modal-header'>
          <img src='/Resources/Themes/DEFAULT/alert24.png' id='warningSmallError' name='warningSmallError' alt='Alert' class='warning-small'>
          <a style='display: inline-block; margin-top: 4px;'>Log Failed</a>
          <img src='/Resources/Themes/DEFAULT/x24.png' id='closeButtonError' name='closeButtonError' onclick='toggleVisibility("errorModal");' alt='Close' title='Close Window' class='close-button'>
          <img src='/Resources/Themes/DEFAULT/help24.png' id='helpError' name='helpError' alt='Help' title='Your login credentials are not valid. This window will disappear shortly. To close this window; press the red "X" icon in the top-right corner of the window.' class='help-button'>
        </div>
        <!-- Failed Login Modal Message Container -->
        <div id='errorContainer' name='errorModal' style='background-color:#f1f1f1; text-align:center; display:block;' class='container'>
          <br />
          <p>Login failed! Please try again.</p>
          <br />
        </div> 
      </div>
    </div>

    <!-- The Critical Login Error Modal -->
    <div id='criticalModal' class='modal'>
      <!-- Critical Login Error Modal Content. -->
      <div id='criticalModalContent' name='criticalModalContent' class='modal-content animate'>
        <!-- Critical Login Error Modal Header -->
        <div id='criticalModalHeader' name='criticalModalHeader' class='modal-header'>
          <img src='/Resources/Themes/DEFAULT/exclamation24.png' id='errorSmallCritical' name='errorSmallCritical' alt='Error' class='error-small'>
          <a style='display: inline-block; margin-top: 4px;'>Login Error</a>
          <img src='/Resources/Themes/DEFAULT/x24.png' id='closeButtonCritical' name='closeButtonCritical' onclick='toggleVisibility("criticalrModal");' alt='Close' title='Close Window' class='close-button'>
          <img src='/Resources/Themes/DEFAULT/help24.png' id='helpCritical' name='helpCritical' alt='Help' title='An error occurred and your login request could not be completed. Please try again later. This window will disappear shortly. To close this window; press the red "X" icon in the top-right corner of the window.' class='help-button'>
        </div>
        <!-- Critical Login Error Modal Message Container -->
        <div id='criticalContainer' name='criticalModal' style='background-color:#f1f1f1; text-align:center; display:block;' class='container'>
          <br />
          <p>There was a critical error during login. Please contact support and try again later.</p>
          <br />
        </div> 
      </div>
    </div>

    <!-- The Logout Modal -->
    <div id='logoutModal' class='modal'>
      <!-- Logout Modal Content. -->
      <div id='logoutModalContent' name='logoutModalContent' class='modal-content animate'>
        <!-- Logout Modal Header -->
        <div id='logoutModalHeader' name='logoutModalHeader' class='modal-header'>
          <img src='/Resources/Themes/DEFAULT/placeholderAvatar.png' id='avatarSmallLogout' name='avatarSmallLogout' alt='Avatar' class='avatar-small'>
          <a style='display: inline-block; margin-top: 4px;'>Logout of <?php echo $ApplicationName; ?></a>
          <img src='/Resources/Themes/DEFAULT/x24.png' id='closeButtonLogout' name='closeButtonLogout' onclick='toggleVisibility("criticalrModal");' alt='Close' title='Close Window' class='close-button'>
          <img src='/Resources/Themes/DEFAULT/help24.png' id='helpLogout' name='helpLogout' alt='Help' title='To log out of your <?php echo $ApplicationName; ?> account; press the "Confirm Logout" button. If you log out of your account you will have to login again before you can continue to use <?php echo $ApplicationName; ?>. To stay logged in; press the "Cancel" button. To close this window without taking any action; press the red "X" icon in the top-right corner of the window.' class='help-button'>
        </div>
        <!-- Logout Modal Message Container -->
        <div id='logoutContainer' name='logoutContainer' style='background-color:#f1f1f1; text-align:center;' class='container'>
          <br />
          <p>Are you sure you want to log out?</p>
          <input type='hidden' id='UserInput' name='UserInput' value='' required>
          <input type='hidden' id='requestTokens' name='RequestTokens' value='' required>
          <br />
          <button id='logoutConfirmButton' onclick='toggleVisibility("logoutModal"); toggleVisibility("logoutButton"); toggleVisibility("loginButton"); toggleVisibility("successModal"); setTimeout(function() { toggleVisibility("successModal"); }, 3000);' class='BUTTON_1'>Confirm Logout</button>
          <hr />
          <button type='button' onclick='toggleVisibility("logoutModal");' class='BUTTON_1' title='Cancel' style='margin:10px;'>Cancel</button>
        </div>
    </div>
  </div>
</div>

<!-- Hidden Login Form For Storing Keep-Alive Variables -->
<form id='tokens' name='tokens' method='post' target='noredirect'>
  <input type='hidden' id='UserInputTokens' name='UserInput' value='' required>
  <input type='hidden' id='SessionID' name='SessionID' value='' required>
  <input type='hidden' id='ClientToken' name='ClientToken' value='' required>
  <input type='hidden' id='ActiveSLI' name='ActiveSLI' value='DISABLED' required>
  <input type='hidden' id='StayLoggedIn' name='StayLoggedIn' value='DISABLED' required>
</form>

<!-- These scripts are loaded at the end of the page to allow the rest of the page to load before introducing additional functionality. -->
<!-- Expect problems if you move these. -->
<script type='text/javascript' src='/Resources/sjcl.js'></script>
<script type='text/javascript' src='/Resources/HRC3-Lib.js'></script>
<script type='text/javascript' src='/Resources/Login-Caller.js'></script>